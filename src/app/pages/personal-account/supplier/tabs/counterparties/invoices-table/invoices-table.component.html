<button pButton label="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç" icon="pi pi-plus" (click)="createNewInvoice()"></button>

<p-table [value]="invoices" class="invoice-table">
    <ng-template pTemplate="header">
        <tr>
            <th *ngFor="let col of columns">{{ col.header }}</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-invoice>
        <tr (dblclick)="editInvoice(invoice.id)" class="invoice-row">
            <td *ngFor="let col of columns" class="invoice-cell">
                <ng-container *ngIf="col.field === 'dateTime'; else normalField">
                  {{ invoice[col.field] | date: 'dd-MM-yyyy HH:mm' }}
                </ng-container>
                <ng-template #normalField>
                  {{ invoice[col.field] }}
                </ng-template>
              </td>
            <td class="invoice-cell">{{ getStatusLabel(invoice.type) }}</td>
            <td class="actions">
                <button class="btn-edit" (click)="editInvoice(invoice.id)">‚úè</button>
                <button class="btn-delete" (click)="deleteInvoice(invoice.id)">üóë</button>
            </td>
        </tr>
    </ng-template>
</p-table>


<ng-container *ngIf="selectedInvoice">

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç–∞ -->
    <p-dialog [(visible)]="selectedInvoice" [modal]="true" [closable]="true" header="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã"
        (onHide)="onDialogClose()">
        <div class="form-container">
            <div class="p-fluid p-formgrid p-grid">
                <div class="p-field p-col-12">
                    <label for="number">–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã</label>
                    <input id="number" [(ngModel)]="selectedInvoice.number" pInputText />
                </div>
                <div class="p-field p-col-12">
                    <label for="dateTime">–î–∞—Ç–∞</label>
                    <p-calendar id="dateTime" [(ngModel)]="selectedInvoice.dateTime" [showTime]="false"></p-calendar>
                </div>
                <!-- <div class="p-field p-col-12">
                <label for="status">–°—Ç–∞—Ç—É—Å</label>
                <p-dropdown id="status" [(ngModel)]="selectedInvoice.status" [options]="statuses" optionLabel="label"></p-dropdown>
            </div> -->
                <div class="p-field p-col-12">
                    <label for="stateNumberCar">–ì–æ—Å. –Ω–æ–º–µ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</label>
                    <input id="stateNumberCar" [(ngModel)]="selectedInvoice.stateNumberCar" pInputText />
                </div>
                <!-- <div class="p-field p-col-12">
                <label for="incomeSum">–ü—Ä–∏—Ö–æ–¥ —Å—É–º–º–∞</label>
                <p-inputnumber id="incomeSum" [(ngModel)]="selectedInvoice.incomeSum"></p-inputnumber>
            </div>
            <div class="p-field p-col-12">
                <label for="expenseSum">–†–∞—Å—Ö–æ–¥ —Å—É–º–º–∞</label>
                <p-inputnumber id="expenseSum" [(ngModel)]="selectedInvoice.expenseSum"></p-inputnumber>
            </div> -->
                <div class="p-field p-col-12">
                    <label for="type">–¢–∏–ø</label>
                    <p-dropdown id="type" [(ngModel)]="selectedInvoice.type" [options]="types"
                        optionLabel="label"></p-dropdown>
                </div>
                <div class="p-field p-col-12">
                    <label for="tax">–ù–∞–ª–æ–≥</label>
                    <p-dropdown id="tax" [(ngModel)]="selectedInvoice.tax" [options]="taxes"
                        optionLabel="label"></p-dropdown>
                </div>
                <button (click)="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É</button>
                <p-table [value]="selectedInvoice.productList">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–°—É–º–º–∞</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-product let-i="rowIndex">
                        <tr>
                            <td><input [(ngModel)]="product.name" pInputText /></td>
                            <td><p-inputnumber [(ngModel)]="product.quantity"></p-inputnumber></td>
                            <td><p-inputnumber [(ngModel)]="product.amount"></p-inputnumber></td>
                            <td><button (click)="removeProduct(i)">–£–¥–∞–ª–∏—Ç—å</button></td>
                        </tr>
                    </ng-template>
                </p-table>

            </div>
            <p-footer>
                <button pButton label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" icon="pi pi-check" (click)="saveInvoice()"></button>
                <button pButton label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É" icon="pi pi-check" (click)="sendingInvoice(selectedInvoice.id)"></button>
            </p-footer>
        </div>
    </p-dialog>


</ng-container>

<p-confirmDialog></p-confirmDialog>